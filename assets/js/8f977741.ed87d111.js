(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{120:function(e,t,r){"use strict";r.d(t,"a",(function(){return u})),r.d(t,"b",(function(){return m}));var n=r(0),i=r.n(n);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}var d=i.a.createContext({}),l=function(e){var t=i.a.useContext(d),r=t;return e&&(r="function"==typeof e?e(t):c(c({},t),e)),r},u=function(e){var t=l(e.components);return i.a.createElement(d.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return i.a.createElement(i.a.Fragment,{},t)}},b=i.a.forwardRef((function(e,t){var r=e.components,n=e.mdxType,a=e.originalType,o=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),u=l(r),b=n,m=u["".concat(o,".").concat(b)]||u[b]||p[b]||a;return r?i.a.createElement(m,c(c({ref:t},d),{},{components:r})):i.a.createElement(m,c({ref:t},d))}));function m(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var a=r.length,o=new Array(a);o[0]=b;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c.mdxType="string"==typeof e?e:n,o[1]=c;for(var d=2;d<a;d++)o[d]=r[d];return i.a.createElement.apply(null,o)}return i.a.createElement.apply(null,r)}b.displayName="MDXCreateElement"},97:function(e,t,r){"use strict";r.r(t),r.d(t,"frontMatter",(function(){return o})),r.d(t,"metadata",(function(){return c})),r.d(t,"toc",(function(){return s})),r.d(t,"default",(function(){return l}));var n=r(3),i=r(7),a=(r(0),r(120)),o={sidebar_position:6},c={unversionedId:"design-documents/architecture",id:"design-documents/architecture",isDocsHomePage:!1,title:"Hydro-SDK Design",description:"Objective",source:"@site/docs/design-documents/architecture.md",sourceDirName:"design-documents",slug:"/design-documents/architecture",permalink:"/docs/design-documents/architecture",editUrl:"https://github.com/hydro-sdk/hydro-sdk.io/edit/main/docs/design-documents/architecture.md",version:"current",sidebarPosition:6,frontMatter:{sidebar_position:6},sidebar:"tutorialSidebar",previous:{title:"Registry",permalink:"/docs/design-documents/registry"},next:{title:"Edge Cases and Errors",permalink:"/docs/edge-cases-and-errors"}},s=[{value:"Objective",id:"objective",children:[]},{value:"Background",id:"background",children:[{value:"Android APK Updating",id:"android-apk-updating",children:[]},{value:"UI as Configuration",id:"ui-as-configuration",children:[]},{value:"UI as Configuration from Dart",id:"ui-as-configuration-from-dart",children:[]},{value:"Native Bridge",id:"native-bridge",children:[]},{value:"Virtual Machine Written in Dart",id:"virtual-machine-written-in-dart",children:[]}]},{value:"Hydro-SDK",id:"hydro-sdk",children:[{value:"Runtime",id:"runtime",children:[]},{value:"Compile Time",id:"compile-time",children:[]},{value:"Project Build Time",id:"project-build-time",children:[]},{value:"Automatic Language Projection (ALP)",id:"automatic-language-projection-alp",children:[]}]}],d={toc:s};function l(e){var t=e.components,r=Object(i.a)(e,["components"]);return Object(a.b)("wrapper",Object(n.a)({},d,r,{components:t,mdxType:"MDXLayout"}),Object(a.b)("h2",{id:"objective"},"Objective"),Object(a.b)("p",null,"Provide a complete software development kit (SDK) to allow developers to build Flutter experiences in languages other than Dart and deliver those experiences over the air (OTA)."),Object(a.b)("h2",{id:"background"},"Background"),Object(a.b)("p",null,"The API surface, development experience (hot-reload) and deployment model (native AOT) of Flutter combine to make it a fantastic choice for building apps. "),Object(a.b)("p",null,"Codepush services built for web based development frameworks like Cordova, Ionic and React Native have shown to provide tremendous value for users of those frameworks. While Flutter's native AOT deployment model provides for great performance, it precludes any kind of over the air delivery."),Object(a.b)("p",null,"Many have tried and are working on different approaches to bring an OTA capability to Flutter. In general, these approaches can be broadly classified into a few categories:"),Object(a.b)("h3",{id:"android-apk-updating"},"Android APK Updating"),Object(a.b)("p",null,"Use native Android APIs to download and update the installed APK."),Object(a.b)("h3",{id:"ui-as-configuration"},"UI as Configuration"),Object(a.b)("p",null,"Use JSON (or another format) to describe trees of widgets."),Object(a.b)("h3",{id:"ui-as-configuration-from-dart"},"UI as Configuration from Dart"),Object(a.b)("p",null,"Parse Dart source code to produce JSON (or another format) to describe trees of widgets. Some initiatives have taken this a step further by building recursive AST interpreters for a subset of the parsed Dart source code. Examples are ",Object(a.b)("a",{parentName:"p",href:"https://tech.meituan.com/2020/06/23/meituan-flutter-flap.html"},"Meituan Waimai's Flap")," or ",Object(a.b)("a",{parentName:"p",href:"https://github.com/wuba/fair"},"Wuba's Fair"),"."),Object(a.b)("h3",{id:"native-bridge"},"Native Bridge"),Object(a.b)("p",null,"Wether using V8, Javascript Core or some other Javascript engine. Enable developers to write code in Javascript with Flutter like APIs. Use a Javascript engine at runtime to connect Javascript to Dart and the Flutter framework. Examples of this are ",Object(a.b)("a",{parentName:"p",href:"https://github.com/openkraken"},"Taobaos's Kraken")," and ",Object(a.b)("a",{parentName:"p",href:"https://github.com/tencent/mxflutter"},"Tencent's MxFlutter")),Object(a.b)("h3",{id:"virtual-machine-written-in-dart"},"Virtual Machine Written in Dart"),Object(a.b)("p",null,"A virtual machine for a new or existing language written entirely in Dart. Examples of this are ",Object(a.b)("a",{parentName:"p",href:"https://github.com/hetu-script"},"Hetu")," and ",Object(a.b)("a",{parentName:"p",href:"https://github.com/ApolloVM/apollovm_dart"},"AppoloVM"),"."),Object(a.b)("h2",{id:"hydro-sdk"},"Hydro-SDK"),Object(a.b)("p",null,"Hydro-SDK aims to differentiate itself from the above categories by providing a tight vertical integration of the entire development and deployment experience from writing code to deploying it."),Object(a.b)("p",null,"Each layer of Hydro-SDK should be small and as generic as possible. Where cross cutting concerns must happen in order to enable a feature (for example, hot-reload) it should be isolated and itself built as generically as possible."),Object(a.b)("h3",{id:"runtime"},"Runtime"),Object(a.b)("p",null,"Hydro-SDK aims to have as small of a runtime footprint as possible. Hydro-SDKs runtime system, ",Object(a.b)("a",{parentName:"p",href:"https://hydro-sdk.io/docs/design-documents/cfr"},"common Flutter runtime (CFR)")," is a subset of a Lua 5.2 environment. It provides an interpreter for Lua 5.2 bytecode, a set of Lua 5.2 intrinsics and a binding system for clean and powerful interop with Dart code. Poviding a full Lua parser and runtime compiler is out of scope. All complexity related to compiling and packaging code is left to other layers. This is similar to the philosophy of ",Object(a.b)("a",{parentName:"p",href:"https://hermesengine.dev/"},"the Hermes Engine"),"."),Object(a.b)("h3",{id:"compile-time"},"Compile Time"),Object(a.b)("p",null,"Compiling Typescript to Lua source code, managing incremental compilations and generating debugging symbols is the responsibility of the ",Object(a.b)("inlineCode",{parentName:"p"},"ts2hc")," SDK-tool. Compiling Lua source code to bytecode is separately handled by the ",Object(a.b)("inlineCode",{parentName:"p"},"luac52")," SDK-tool."),Object(a.b)("h3",{id:"project-build-time"},"Project Build Time"),Object(a.b)("p",null,Object(a.b)("inlineCode",{parentName:"p"},"build-project"),", ",Object(a.b)("inlineCode",{parentName:"p"},"run-project")," and ",Object(a.b)("inlineCode",{parentName:"p"},"codepush")," SDK-tools all need to be able build and package projects for different purposes. Project building is managed by the ",Object(a.b)("a",{parentName:"p",href:"https://github.com/hydro-sdk/hydro-sdk/tree/master/lib/build-project"},Object(a.b)("inlineCode",{parentName:"a"},"*Builder")," family of classes")," and shared across SDK-tools."),Object(a.b)("h3",{id:"automatic-language-projection-alp"},"Automatic Language Projection (ALP)"),Object(a.b)("p",null,"Hydro-SDK aims to differentiate itself most critically by allowing rich interop with Dart packages. All tooling related to ALP is managed by ",Object(a.b)("a",{parentName:"p",href:"https://hydro-sdk.io/docs/design-documents/swid"},"SWID"),"."))}l.isMDXComponent=!0}}]);