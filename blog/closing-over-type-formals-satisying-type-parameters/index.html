<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.73">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Hydro-SDK Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Hydro-SDK Blog Atom Feed"><title data-react-helmet="true">Hydro-SDK</title><meta data-react-helmet="true" name="description" content="Adventures in automatically binding Dart to TypeScript."><meta data-react-helmet="true" property="og:description" content="Adventures in automatically binding Dart to TypeScript."><meta data-react-helmet="true" property="og:url" content="https://hydro-sdk.github.io/blog/closing-over-type-formals-satisying-type-parameters"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><meta data-react-helmet="true" property="og:title" content="Hydro-SDK"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://hydro-sdk.github.io/blog/closing-over-type-formals-satisying-type-parameters"><link data-react-helmet="true" rel="alternate" href="https://hydro-sdk.github.io/blog/closing-over-type-formals-satisying-type-parameters" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://hydro-sdk.github.io/blog/closing-over-type-formals-satisying-type-parameters" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.2445322a.css">
<link rel="preload" href="/assets/js/styles.55850577.js" as="script">
<link rel="preload" href="/assets/js/runtime~main.f3a979aa.js" as="script">
<link rel="preload" href="/assets/js/main.f3e0b007.js" as="script">
<link rel="preload" href="/assets/js/1.d1dbedd0.js" as="script">
<link rel="preload" href="/assets/js/2.bf440381.js" as="script">
<link rel="preload" href="/assets/js/3.4f30a322.js" as="script">
<link rel="preload" href="/assets/js/ccc49370.e6ec166a.js" as="script">
<link rel="preload" href="/assets/js/4ad842c4.d31a65c0.js" as="script">
<link rel="preload" href="/assets/js/a24b2696.01b2f29b.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="Hydro-SDK Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.png" alt="Hydro-SDK Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Hydro-SDK</strong></a><a class="navbar__item navbar__link" docid="intro" href="/docs/intro">Getting Started</a><a class="navbar__item navbar__link" docid="codepush" href="/docs/codepush">Codepush</a><a href="https://registry.hydro-sdk.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Registry</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/hydro-sdk" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="Hydro-SDK Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.png" alt="Hydro-SDK Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Hydro-SDK</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" docid="intro" href="/docs/intro">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" docid="codepush" href="/docs/codepush">Codepush</a></li><li class="menu__list-item"><a href="https://registry.hydro-sdk.io" target="_blank" rel="noopener noreferrer" class="menu__link">Registry</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/hydro-sdk" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><div class="col col--3"><div class="sidebar_2ahu thin-scrollbar"><h3 class="sidebarItemTitle_2hhb">Recent posts</h3><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/dartup-2021">DartUP 2021</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/fluttering-over-the-air">Fluttering Over the Air</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/mangling-dynamic-language-symbols">Mangling Dynamic Language Symbols, Uniquely Addressing the Atoms of Hot-Reload</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/expressing-inexpressible-constant-values">Expressing Inexpressible Constant Values</a></li><li class="sidebarItem_2UVv"><a aria-current="page" class="sidebarItemLink_1RT6 sidebarItemLinkActive_12pM" href="/blog/closing-over-type-formals-satisying-type-parameters">Closing Over Type Formals, Satisfying Type Parameters</a></li></ul></div></div><main class="col col--7"><article><header><h1 class="margin-bottom--sm blogPostTitle_GeHD">Closing Over Type Formals, Satisfying Type Parameters</h1><div class="margin-vert--md"><time datetime="2021-02-07T00:00:00.000Z" class="blogPostDate_fNvV">February 7, 2021 · 5 min read</time></div><div class="avatar margin-vert--md"><a href="https://github.com/chgibb" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/u/18079458?s=400&amp;v=4" alt="Chris Gibb"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/chgibb" target="_blank" rel="noopener noreferrer">Chris Gibb</a></h4><small class="avatar__subtitle">Recovering Structural Typing Enthusiast</small></div></div></header><div class="markdown"><p>Adventures in automatically binding Dart to TypeScript.</p><p>This was originally posted here: <a href="https://chgibb.github.io/closing-over-type-formals-satisying-type-parameters/" target="_blank" rel="noopener noreferrer">https://chgibb.github.io/closing-over-type-formals-satisying-type-parameters/</a></p><p><a href="https://github.com/hydro-sdk/hydro-sdk" target="_blank" rel="noopener noreferrer">Hydro-SDK</a> is a project with one large, ambitious goal. &quot;Become React Native for Flutter&quot;.<br>
It aims to do that by:</p><ol><li>Decoupling the API surface of Flutter from  the Dart programming language.</li><li>Decoupling the development time experience of Flutter from the Dart programming language.</li><li>Providing first-class support for over-the-air distribution of code.</li><li>Providing an ecosystem of packages from <code>pub.dev</code>, automatically projected to supported languages and published to other package systems.</li></ol><p>I wrote previously about the past and future of <a href="https://github.com/hydro-sdk/hydro-sdk" target="_blank" rel="noopener noreferrer">Hydro-SDK</a> <a href="https://chgibb.github.io/one-year-of-hydro-sdk/" target="_blank" rel="noopener noreferrer">here</a>. </p><p>Structured Wrapper and Interface generator for Dart (SWID) is a component of Hydro-SDK supporting goals 1 and 4. SWID takes as input a Dart package (like <code>package:flutter</code>) and produces as output TypeScript files representing the input Dart package&#x27;s public API and Dart files to allow for glueing TypeScript code written against that API together into a host app that can be run on Hydro-SDK&#x27;s Common Flutter Runtime (CFR). This process is referred to as &quot;language projection&quot;. </p><p>Representing Dart constructs in TypeScript has come with many challenges. The most interesting so far has been Dart&#x27;s <a href="https://dart.dev/guides/language/language-tour#factory-constructors" target="_blank" rel="noopener noreferrer"><code>factory</code> constructors</a>. Consider the <code>Iterable</code> class from <code>dart:core</code>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly dart"><div tabindex="0" class="prism-code language-dart codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">//abridged for readability</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class Iterable&lt;E&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Iterable&lt;E&gt; Iterable();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Iterable&lt;T&gt; map&lt;T&gt;(T f(E e))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    factory Iterable&lt;E&gt; Iterable&lt;E&gt;.empty()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The <code>empty</code> factory allows consumers to write code like the following:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly dart"><div tabindex="0" class="prism-code language-dart codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Iterable&lt;MyType&gt; myEmptyIterable = Iterable&lt;MyType&gt;.empty();</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Factory constructors are nothing new. While TypeScript doesn&#x27;t have direct support at the language level as Dart does, the same syntax for consumers can be had by the following class:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly typescript"><div tabindex="0" class="prism-code language-typescript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name maybe-class-name" style="color:rgb(255, 203, 107)">Iterable</span><span class="token class-name operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token class-name constant" style="color:rgb(130, 170, 255)">E</span><span class="token class-name operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">constructor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token generic-function function" style="color:rgb(130, 170, 255)">map</span><span class="token generic-function generic class-name operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token generic-function generic class-name constant" style="color:rgb(130, 170, 255)">T</span><span class="token generic-function generic class-name operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function-variable function" style="color:rgb(130, 170, 255)">f</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">e</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">E</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">T</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token maybe-class-name">Iterable</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token constant" style="color:rgb(130, 170, 255)">T</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">empty</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token maybe-class-name">Iterable</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token constant" style="color:rgb(130, 170, 255)">E</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p> Which would enable consumers to call the <code>empty</code> method from TypeScript as the following:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly typescript"><div tabindex="0" class="prism-code language-typescript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> myEmptyIterable</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token maybe-class-name">Iterable</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token maybe-class-name">MyType</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token maybe-class-name">Iterable</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">empty</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p> It would, except the definition of <code>Iterable.empty</code> in our TypeScript <code>Iterable</code> class above is actually invalid. The TypeScript compiler tells us that <code>Static members cannot reference class type parameters.(2302)</code>. There is a fairly lengthy discussion on why the TS2302 error exists and why this is the case over on the TypeScript repo <a href="https://github.com/microsoft/TypeScript/issues/32211" target="_blank" rel="noopener noreferrer">here</a> which is out of scope for this post. The jist of the problem is that our <code>empty</code> method is trying to reference the type parameter <code>E</code> which is defined on the class. </p><p>SWID is structured as a frontend which takes in Dart source code, producing an intermediate representation (IR). This IR is then passed onto the TypeScript backend to produce TypeScript source code. SWID IR closely mirrors an abstract syntax tree (AST) of the input Dart code. The <code>empty</code> <code>factory</code> constructor in the original <code>Iterable</code> class defines no type parameters of its own and makes references to <code>E</code> defined on the class and therefore so does the IR and the output TypeScript. From a purely code generation perspective, our TypeScript <code>Iterable</code> class is perfect. From a perspective of semantics preservation from our input language (and simply a correctness perspective), this is obviously far from perfect.</p><p>In SWID IR, the declaration of a generic type is said to be a type formal while uses of that generic are said to be type parameters. In SWID parlance, the <code>Iterable</code> class declares a type formal <code>E</code> while <code>empty</code> has a type parameter <code>E</code>.</p><p>In order to stop the TypeScript backend from producing broken code in the face of patterns like <code>Iterable</code>, a type propagation pass was introduced prior to sending IR off to be turned into TypeScript. The type propagation pass is responsible for rewriting IR in order to satisfy type parameters that are unsatisfied. </p><p>In SWID IR, a type formal closure defines all of the type formals that are in scope for a particular IR node. A type parameter is said to be unsatisfied if there is no type formal in it&#x27;s type formal closure that matches it. The extent to which a particular IR node closes over the type formals of its parent nodes depends on the position of the IR node.</p><p>The <code>map</code> method in the <code>Iterable</code> class for example has type parameters <code>E</code>, and <code>T</code>. The type formal closure of <code>map</code> consists of <code>T</code> because <code>T</code> is declared on <code>map</code> itself as well as <code>E</code> because <code>map</code> is an instance method of <code>Iterable</code>.</p><p>The <code>empty</code> method in the <code>Iterable</code> class has a type parameter <code>E</code> but its type formal closure contains nothing. <code>empty</code> is a static method and therefore does not close over the type formals of it&#x27;s parent <code>class</code>.</p><p>The type propagation pass will discover the unsatisfied type parameter <code>E</code> in the <code>empty</code> method, realise that it could be satisfied if the type formal <code>E</code> declared on its parent <code>class</code> was also made a type formal of <code>empty</code> itself and perform the rewriting. This gives us the following <code>Iterable</code> class:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly typescript"><div tabindex="0" class="prism-code language-typescript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name maybe-class-name" style="color:rgb(255, 203, 107)">Iterable</span><span class="token class-name operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token class-name constant" style="color:rgb(130, 170, 255)">E</span><span class="token class-name operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">constructor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token generic-function function" style="color:rgb(130, 170, 255)">map</span><span class="token generic-function generic class-name operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token generic-function generic class-name constant" style="color:rgb(130, 170, 255)">T</span><span class="token generic-function generic class-name operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function-variable function" style="color:rgb(130, 170, 255)">f</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">e</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">E</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">T</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token maybe-class-name">Iterable</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token constant" style="color:rgb(130, 170, 255)">T</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token generic-function function" style="color:rgb(130, 170, 255)">empty</span><span class="token generic-function generic class-name operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token generic-function generic class-name constant" style="color:rgb(130, 170, 255)">E</span><span class="token generic-function generic class-name operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token maybe-class-name">Iterable</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token constant" style="color:rgb(130, 170, 255)">E</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>With consumers able to use it like the following:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly typescript"><div tabindex="0" class="prism-code language-typescript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> myEmptyIterable</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token maybe-class-name">Iterable</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token maybe-class-name">MyType</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token maybe-class-name">Iterable</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token generic-function function" style="color:rgb(130, 170, 255)">empty</span><span class="token generic-function generic class-name operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token generic-function generic class-name maybe-class-name" style="color:rgb(255, 203, 107)">MyType</span><span class="token generic-function generic class-name operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p> The end result for consumers is having to shift where they ordinarily write their generics when calling <code>factory</code> constructors.</p><p> The type propagation pass itself can be found <a href="https://github.com/hydro-sdk/hydro-sdk/blob/0.0.1-nightly.99/lib/swid/ir/frontend/dart/util/propagateUnsatisfiedTypeParameters.dart" target="_blank" rel="noopener noreferrer">here</a>. Tests for satisfying type parameters and propagating formals can be found <a href="https://github.com/hydro-sdk/hydro-sdk/blob/0.0.1-nightly.99/test/swid/typeFormals/unsatisfiedTypeFormals_test.dart" target="_blank" rel="noopener noreferrer">here</a>. The extent of type formal closures can be controlled by the <code>SwidClassTypeFormalClosureKind</code> <code>enum</code>. SWID&#x27;s TypeScript backend uses <code>SwidClassTypeFormalClosureKind.kNoCloseOverTypeFormalsInStaticMembers</code> for propagation. Other options exist to preserve Dart&#x27;s semantics should a future SWID backend need to.</p><p> Hopefully this problem and its solution was as fun to read about as it was to discover and solve. Hydro-SDK is an endless fractal of problems like this. Hopefully I&#x27;ll be able to make &quot;Adventures in automatically binding Dart to TypeScript&quot; a series of posts.</p></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/flutter">flutter</a><a class="margin-horiz--sm" href="/blog/tags/typescript">typescript</a><a class="margin-horiz--sm" href="/blog/tags/react-native">react-native</a></div></footer></article><div><a href="https://github.com/hydro-sdk/hydro-sdk.io/edit/main/blog/2021-02-07-closing-over-type-formals-satisying-type-parameters.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="margin-vert--xl"><nav class="pagination-nav" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/expressing-inexpressible-constant-values"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">« Expressing Inexpressible Constant Values</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/one-year-of-hydro-sdk"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">One Year of Hydro-SDK »</div></a></div></nav></div></main><div class="col col--2"><div class="tableOfContents_35-E thin-scrollbar"></div></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/codepush">Codepush</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/hydro-sdk/hydro-sdk/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discussions</a></li><li class="footer__item"><a href="https://discord.gg/DuM2vkUSNr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/hydro-sdk" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021 Hydro-SDK. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/styles.55850577.js"></script>
<script src="/assets/js/runtime~main.f3a979aa.js"></script>
<script src="/assets/js/main.f3e0b007.js"></script>
<script src="/assets/js/1.d1dbedd0.js"></script>
<script src="/assets/js/2.bf440381.js"></script>
<script src="/assets/js/3.4f30a322.js"></script>
<script src="/assets/js/ccc49370.e6ec166a.js"></script>
<script src="/assets/js/4ad842c4.d31a65c0.js"></script>
<script src="/assets/js/a24b2696.01b2f29b.js"></script>
</body>
</html>