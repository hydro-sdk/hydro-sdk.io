<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.73">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Hydro-SDK Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Hydro-SDK Blog Atom Feed"><title data-react-helmet="true">Hydro-SDK</title><meta data-react-helmet="true" name="description" content="Adventures in automatically binding Dart to TypeScript."><meta data-react-helmet="true" property="og:description" content="Adventures in automatically binding Dart to TypeScript."><meta data-react-helmet="true" property="og:url" content="https://hydro-sdk.github.io/blog/expressing-inexpressible-constant-values"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><meta data-react-helmet="true" property="og:title" content="Hydro-SDK"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://hydro-sdk.github.io/blog/expressing-inexpressible-constant-values"><link data-react-helmet="true" rel="alternate" href="https://hydro-sdk.github.io/blog/expressing-inexpressible-constant-values" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://hydro-sdk.github.io/blog/expressing-inexpressible-constant-values" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.2445322a.css">
<link rel="preload" href="/assets/js/styles.f2119814.js" as="script">
<link rel="preload" href="/assets/js/runtime~main.1c820a1b.js" as="script">
<link rel="preload" href="/assets/js/main.51ac3bbb.js" as="script">
<link rel="preload" href="/assets/js/1.8aac5b68.js" as="script">
<link rel="preload" href="/assets/js/2.fcee5821.js" as="script">
<link rel="preload" href="/assets/js/3.a921d1e3.js" as="script">
<link rel="preload" href="/assets/js/ccc49370.836208fd.js" as="script">
<link rel="preload" href="/assets/js/4ad842c4.35d7f0eb.js" as="script">
<link rel="preload" href="/assets/js/4b778623.5e4ca196.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="Hydro-SDK Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.png" alt="Hydro-SDK Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Hydro-SDK</strong></a><a class="navbar__item navbar__link" docid="intro" href="/docs/intro">Getting Started</a><a class="navbar__item navbar__link" docid="codepush" href="/docs/codepush">Codepush</a><a href="https://registry.hydro-sdk.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Registry</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/hydro-sdk" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="Hydro-SDK Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.png" alt="Hydro-SDK Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Hydro-SDK</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" docid="intro" href="/docs/intro">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" docid="codepush" href="/docs/codepush">Codepush</a></li><li class="menu__list-item"><a href="https://registry.hydro-sdk.io" target="_blank" rel="noopener noreferrer" class="menu__link">Registry</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/hydro-sdk" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><div class="col col--3"><div class="sidebar_2ahu thin-scrollbar"><h3 class="sidebarItemTitle_2hhb">Recent posts</h3><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/two-years-of-hydro-sdk">Two Years of Hydro-SDK</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/dartup-2021">DartUP 2021</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/fluttering-over-the-air">Fluttering Over the Air</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/mangling-dynamic-language-symbols">Mangling Dynamic Language Symbols, Uniquely Addressing the Atoms of Hot-Reload</a></li><li class="sidebarItem_2UVv"><a aria-current="page" class="sidebarItemLink_1RT6 sidebarItemLinkActive_12pM" href="/blog/expressing-inexpressible-constant-values">Expressing Inexpressible Constant Values</a></li></ul></div></div><main class="col col--7"><article><header><h1 class="margin-bottom--sm blogPostTitle_GeHD">Expressing Inexpressible Constant Values</h1><div class="margin-vert--md"><time datetime="2021-04-03T00:00:00.000Z" class="blogPostDate_fNvV">April 3, 2021 · 5 min read</time></div><div class="avatar margin-vert--md"><a href="https://github.com/chgibb" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/u/18079458?s=400&amp;v=4" alt="Chris Gibb"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/chgibb" target="_blank" rel="noopener noreferrer">Chris Gibb</a></h4><small class="avatar__subtitle">Recovering Structural Typing Enthusiast</small></div></div></header><div class="markdown"><p>Adventures in automatically binding Dart to TypeScript.</p><p>This was originally posted here: <a href="https://chgibb.github.io/expressing-inexpressible-constant-values/" target="_blank" rel="noopener noreferrer">https://chgibb.github.io/expressing-inexpressible-constant-values/</a></p><p><a href="https://github.com/hydro-sdk/hydro-sdk" target="_blank" rel="noopener noreferrer">Hydro-SDK</a> is a project with one large, ambitious goal. &quot;Become React Native for Flutter&quot;.<br>
It aims to do that by:</p><ol><li>Decoupling the API surface of Flutter from  the Dart programming language.</li><li>Decoupling the development time experience of Flutter from the Dart programming language.</li><li>Providing first-class support for over-the-air distribution of code.</li><li>Providing an ecosystem of packages from <code>pub.dev</code>, automatically projected to supported languages and published to other package systems.</li></ol><p>I wrote previously about the past and future of <a href="https://github.com/hydro-sdk/hydro-sdk" target="_blank" rel="noopener noreferrer">Hydro-SDK</a> <a href="https://chgibb.github.io/one-year-of-hydro-sdk/" target="_blank" rel="noopener noreferrer">here</a>. </p><p>Structured Wrapper and Interface generator for Dart (SWID) is a component of Hydro-SDK supporting goals 1 and 4. SWID takes as input a Dart package (like <code>package:flutter</code>) and produces as output TypeScript files representing the input Dart package&#x27;s public API and Dart files to allow for gluing TypeScript code written against that API together into a host app that can be run on Hydro-SDK&#x27;s Common Flutter Runtime (CFR). This process is referred to as &quot;language projection&quot;. </p><p>Representing Dart constructs in TypeScript has come with many challenges. One recently encountered is how to express constant values which are composed of private symbols. </p><p>Every Flutter programmer should be familiar with the concept of <code>const</code> in Dart. It’s used perhaps most prolifically in Flutter’s Material and Cupertino design icons APIs. For instance, the <code>Icons</code> class in Flutter’s <code>material</code> library contains thousands of static fields that appear like the following which represents the &quot;directions boat&quot; material design icon: </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly dart"><div tabindex="0" class="prism-code language-dart codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">//package:flutter/lib/src/material/icons.dart</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class Icons {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Icons._();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    //abridged</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    static const IconData directions_boat = IconData(0xe6b9, fontFamily: &#x27;MaterialIcons&#x27;); </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Describing how Flutter <code>IconData</code> instances, font ligatures and font loading work is out of scope of this article.</p><p>When performing language projection of <code>package:flutter</code>, SWID will emit the above declaration as the following:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly typescript"><div tabindex="0" class="prism-code language-typescript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//runtime/flutter/material/icons.ts</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">IconData</span><span class="token imports"> </span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;./../widgets/iconData&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">export</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name maybe-class-name" style="color:rgb(255, 203, 107)">Icons</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//abridged</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> directions_boat </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name maybe-class-name" style="color:rgb(255, 203, 107)">IconData</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">0xe6b9</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        fontFamily</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;MaterialIcons&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>SWID will perform a simple syntax transform for the <code>Icons</code> class and <code>directions_boat</code> field while making sure the translation unit (<code>flutter/material/icons.ts</code>) imports required symbols (in this case, simply <code>IconData</code>). </p><p>The only area of language projection that SWID aims to describe one-to-one between Dart and TypeScript is <code>const</code> values. This is done to free host applications from having to compile every possible constant value that guest code might want to access. This approach works great for constant values that consist simply of public symbols (like <code>IconData</code> above), and primitive values.</p><p>This becomes trickier however when fields consist of private symbols. For instance, the <code>Rect</code> class from <code>dart:ui</code> has some static constant fields which are declared as the following:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly dart"><div tabindex="0" class="prism-code language-dart codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">//package:sky_engine/ui/geometry.dart</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class Rect {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    static const Rect zero = Rect.fromLTRB(0.0, 0.0, 0.0, 0.0);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    static const double _giantScalar = 1.0E+9; </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    static const Rect largest = Rect.fromLTRB(-_giantScalar, -_giantScalar, _giantScalar, _giantScalar);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The <code>zero</code> field references a public static method, so it is fine to perform a simple syntax transform. At first glance, the <code>largest</code> field appears impossible to express in TypeScript. There is no way to expose the <code>_giantScalar</code> symbol in a way that it can be accessed from TypeScript. </p><p>SWID has enough semantic understanding to understand that the reference to <code>_giantScalar</code> from <code>largest</code> is not only a field on <code>Rect</code> but that it&#x27;s also just a primitive. Therefore, both are safe to emit.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly typescript"><div tabindex="0" class="prism-code language-typescript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//runtime/dart/ui/rect.ts</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">export</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name maybe-class-name" style="color:rgb(255, 203, 107)">Rect</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> zero </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token maybe-class-name">Rect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">fromLTRB</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">0.0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0.0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0.0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0.0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">private</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> _giantScalar </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1.0e9</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> largest </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token maybe-class-name">Rect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">fromLTRB</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token maybe-class-name">Rect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">_giantScalar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token maybe-class-name">Rect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">_giantScalar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token maybe-class-name">Rect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">_giantScalar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token maybe-class-name">Rect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">_giantScalar</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>SWID&#x27;s semantic understanding of the Dart code it is projecting allow it to categorize constant values into two categories: &quot;expressible&quot; and &quot;inexpressible&quot;. Constant values which can be decomposed into references to primitives or public symbols are considered to be &quot;expressible&quot;. In the <code>Rect</code> example above, <code>_giantScalar</code>, despite being private, decomposes into a reference to a primitive which allows <code>largest</code> to decompose into primitive references. <code>largest</code> referencing <code>_giantScalar</code> causes <code>_giantScalar</code> to be emitted in the final translation unit.</p><p>Consider the <code>Endian</code> class from <code>dart:typed_data</code>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly dart"><div tabindex="0" class="prism-code language-dart codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">//package:sky_engine/typed_data/typed_data.dart</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class Endian {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  final bool _littleEndian;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  const Endian._(this._littleEndian);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  static const Endian big = const Endian._(false);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  static const Endian little = const Endian._(true);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  //abridged</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Here, <code>big</code> and <code>little</code> both include references to a private constructor. This can&#x27;t be further decomposed into an expressible form and so both fields are considered to be &quot;inexpressible&quot;. SWID expresses &quot;inexpressible&quot; constant values by emitting code like the following:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly typescript"><div tabindex="0" class="prism-code language-typescript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//runtime/dart/typed_data/endian.ts</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> dart</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    typed_data</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">endianBig</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">this</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token maybe-class-name">Endian</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">endianLittle</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">this</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token maybe-class-name">Endian</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//abridged</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">export</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name maybe-class-name" style="color:rgb(255, 203, 107)">Endian</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> big </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> dart</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">typed_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">endianBig</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> little </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> dart</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">typed_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">endianLittle</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The <code>declare</code> block is what SWID calls a &quot;virtual machine declaration&quot;. This is a typed description of the environment that the code in the given translation unit expects. &quot;virtual machine declarations&quot; in SWID&#x27;s TypeScript backend and their associated &quot;namespace symbol declarations&quot; that fulfill their expectations in SWID&#x27;s Dart backend are how SWID expresses API bindings not just for &quot;inexpressible&quot; constant values but for all methods and fields. This binding system will be the subject of a future blog post.</p><p>As seen above, <code>big</code> and <code>little</code> are expressed as calls to their associated declarations. Unfortunately, this scheme prevents the host application from ever being able to tree-shake away the definitions of <code>big</code> and <code>little</code> but still allows guest code access to these fields.</p><p>Hopefully this problem and its solution was as fun to read about as it was to discover and solve. Hydro-SDK is an endless fractal of problems like this. Hopefully I’ll be able to make “Adventures in automatically binding Dart to TypeScript” a continuing series of posts.</p></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/flutter">flutter</a><a class="margin-horiz--sm" href="/blog/tags/typescript">typescript</a><a class="margin-horiz--sm" href="/blog/tags/react-native">react-native</a></div></footer></article><div><a href="https://github.com/hydro-sdk/hydro-sdk.io/edit/main/blog/2021-04-03-expressing-inexpressible-constant-values.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="margin-vert--xl"><nav class="pagination-nav" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/mangling-dynamic-language-symbols"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">« Mangling Dynamic Language Symbols, Uniquely Addressing the Atoms of Hot-Reload</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/closing-over-type-formals-satisying-type-parameters"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Closing Over Type Formals, Satisfying Type Parameters »</div></a></div></nav></div></main><div class="col col--2"><div class="tableOfContents_35-E thin-scrollbar"></div></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/codepush">Codepush</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/hydro-sdk/hydro-sdk/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discussions</a></li><li class="footer__item"><a href="https://discord.gg/DuM2vkUSNr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/hydro-sdk" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Hydro-SDK. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/styles.f2119814.js"></script>
<script src="/assets/js/runtime~main.1c820a1b.js"></script>
<script src="/assets/js/main.51ac3bbb.js"></script>
<script src="/assets/js/1.8aac5b68.js"></script>
<script src="/assets/js/2.fcee5821.js"></script>
<script src="/assets/js/3.a921d1e3.js"></script>
<script src="/assets/js/ccc49370.836208fd.js"></script>
<script src="/assets/js/4ad842c4.35d7f0eb.js"></script>
<script src="/assets/js/4b778623.5e4ca196.js"></script>
</body>
</html>