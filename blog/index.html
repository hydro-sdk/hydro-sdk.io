<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.73">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Hydro-SDK Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Hydro-SDK Blog Atom Feed"><title data-react-helmet="true">Hydro-SDK</title><meta data-react-helmet="true" name="description" content="Blog"><meta data-react-helmet="true" property="og:description" content="Blog"><meta data-react-helmet="true" property="og:url" content="https://hydro-sdk.github.io/blog"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="blog_posts_list"><meta data-react-helmet="true" property="og:title" content="Hydro-SDK"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://hydro-sdk.github.io/blog"><link data-react-helmet="true" rel="alternate" href="https://hydro-sdk.github.io/blog" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://hydro-sdk.github.io/blog" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.2445322a.css">
<link rel="preload" href="/assets/js/styles.104c0177.js" as="script">
<link rel="preload" href="/assets/js/runtime~main.6b4b8414.js" as="script">
<link rel="preload" href="/assets/js/main.718a4841.js" as="script">
<link rel="preload" href="/assets/js/common.f0b432a2.js" as="script">
<link rel="preload" href="/assets/js/2.1e35f16c.js" as="script">
<link rel="preload" href="/assets/js/3.4175dbb4.js" as="script">
<link rel="preload" href="/assets/js/01a85c17.d0889b35.js" as="script">
<link rel="preload" href="/assets/js/1be78505.76a4fcce.js" as="script">
<link rel="preload" href="/assets/js/6875c492.96f4990e.js" as="script">
<link rel="preload" href="/assets/js/a6aa9e1f.ae99bb64.js" as="script">
<link rel="preload" href="/assets/js/c4f5d8e4.946bc6c1.js" as="script">
<link rel="preload" href="/assets/js/ccc49370.833ec531.js" as="script">
<link rel="preload" href="/assets/js/38.dfe7fe76.js" as="script">
<link rel="preload" href="/assets/js/4ad842c4.0cfa62c8.js" as="script">
<link rel="preload" href="/assets/js/13244c14.6386d569.js" as="script">
<link rel="preload" href="/assets/js/42028e53.a87b0199.js" as="script">
<link rel="preload" href="/assets/js/738a2c95.517a8b94.js" as="script">
<link rel="preload" href="/assets/js/2f94a271.6284b725.js" as="script">
<link rel="preload" href="/assets/js/b2b675dd.e30f7b16.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="Hydro-SDK Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.png" alt="Hydro-SDK Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Hydro-SDK</strong></a><a class="navbar__item navbar__link" href="/docs/intro">Tutorial</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/hydro-sdk" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="Hydro-SDK Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.png" alt="Hydro-SDK Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Hydro-SDK</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/intro">Tutorial</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/hydro-sdk" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper blog-wrapper blog-list-page"><div class="container margin-vert--lg"><div class="row"><div class="col col--3"><div class="sidebar_2ahu thin-scrollbar"><h3 class="sidebarItemTitle_2hhb">Recent posts</h3><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/05/20/mangling-dynamic-language-symbols">Mangling Dynamic Language Symbols, Uniquely Addressing the Atoms of Hot-Reload</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/expressing-inexpressible-constant-values">Expressing Inexpressible Constant Values</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/closing-over-type-formals-satisying-type-parameters">Closing Over Type Formals, Satisfying Type Parameters</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/one-year-of-hydro-sdk">One Year of Hydro-SDK</a></li></ul></div></div><main class="col col--7"><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_GeHD"><a href="/blog/2021/05/20/mangling-dynamic-language-symbols">Mangling Dynamic Language Symbols, Uniquely Addressing the Atoms of Hot-Reload</a></h2><div class="margin-vert--md"><time datetime="2021-05-20T00:00:00.000Z" class="blogPostDate_fNvV">May 20, 2021 Â· 10 min read</time></div><div class="avatar margin-vert--md"><div class="avatar__intro"></div></div></header><div class="markdown"><p>Decoupling the development time experience of Flutter from the Dart programming language.  </p><p><a href="https://github.com/hydro-sdk/hydro-sdk" target="_blank" rel="noopener noreferrer">Hydro-SDK</a> is a project with one large, ambitious goal. &quot;Become React Native for Flutter&quot;.<br>
It aims to do that by:</p><ol><li>Decoupling the API surface of Flutter from  the Dart programming language.</li><li>Decoupling the development time experience of Flutter from the Dart programming language.</li><li>Providing first-class support for over-the-air distribution of code.</li><li>Providing an ecosystem of packages from <code>pub.dev</code>, automatically projected to supported languages and published to other package systems.</li></ol><p>I wrote previously about the past and future of <a href="https://github.com/hydro-sdk/hydro-sdk" target="_blank" rel="noopener noreferrer">Hydro-SDK</a> <a href="https://chgibb.github.io/one-year-of-hydro-sdk/" target="_blank" rel="noopener noreferrer">here</a>. </p><p>In this article I want to delve into some of the gritty details of how Hydro-SDK compiles, manages and hot-reloads Typescript code.</p><p><code>ts2hc</code> is a command line program distributed as part of each Hydro-SDK release. <code>ts2hc</code>&#x27;s job is to turn Typescript code into bytecode and debug symbols. Users generally don&#x27;t interact with it directly but rather indirectly through commands like <code>hydroc build</code> and <code>hydroc run</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="build-time"></a>Build Time<a class="hash-link" href="#build-time" title="Direct link to heading">#</a></h2><p>Typescript is lowered into Lua by leveraging the excellent <a href="https://github.com/TypeScriptToLua/TypeScriptToLua" target="_blank" rel="noopener noreferrer">Typescript to Lua (TSTL) library</a>. Consider the following excerpt from the <a href="https://github.com/hydro-sdk/counter-app" target="_blank" rel="noopener noreferrer">Counter-App showcase</a>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly typescript"><div tabindex="0" class="prism-code language-typescript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//counter-app/ota/lib/counterApp.ts</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//...</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token maybe-class-name">StatelessWidget</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;@hydro-sdk/hydro-sdk/runtime/flutter/widgets/index&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//...</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token maybe-class-name">MaterialApp</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;@hydro-sdk/hydro-sdk/runtime/flutter/material/index&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">Widget</span><span class="token imports"> </span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;@hydro-sdk/hydro-sdk/runtime/flutter/widget&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">export</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name maybe-class-name" style="color:rgb(255, 203, 107)">CounterApp</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">extends</span><span class="token plain"> </span><span class="token class-name maybe-class-name" style="color:rgb(255, 203, 107)">StatelessWidget</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">constructor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">super</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">build</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token maybe-class-name">Widget</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name maybe-class-name" style="color:rgb(255, 203, 107)">MaterialApp</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            title</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Counter App&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            initialRoute</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;/&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            home</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name maybe-class-name" style="color:rgb(255, 203, 107)">MyHomePage</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Counter App Home Page&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><code>ts2hc</code> will lower <code>counter-app/ota/lib/counterApp.ts</code>, and all of its dependencies into individual Lua modules. These Lua modules are then bundled, with the result looking something like the following:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly lua"><div tabindex="0" class="prism-code language-lua codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">local package = {preload={}, loaded={}}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">local function require(file)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    local loadedModule = package.loaded[file]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    if loadedModule == nil</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    then</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        loadedModule = package.preload[file]()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        package.loaded[file] = loadedModule</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        return loadedModule</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    return loadedModule</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">package.preload[&quot;ota.lib.counterApp&quot;] = (function (...)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    require(&quot;lualib_bundle&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    local ____exports = {}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    local ____index = require(&quot;ota.@hydro-sdk.hydro-sdk.runtime.flutter.widgets.index&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    -- ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    local StatelessWidget = ____index.StatelessWidget</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    -- ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    local ____index = require(&quot;ota.@hydro-sdk.hydro-sdk.runtime.flutter.material.index&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    local MaterialApp = ____index.MaterialApp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ____exports.CounterApp = __TS__Class()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    local CounterApp = ____exports.CounterApp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    CounterApp.name = &quot;CounterApp&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    __TS__ClassExtends(CounterApp, StatelessWidget)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    function CounterApp.prototype.____constructor(self)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        StatelessWidget.prototype.____constructor(self)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    function CounterApp.prototype.build(self)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        return __TS__New(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            MaterialApp,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                title = &quot;Counter App&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                initialRoute = &quot;/&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                home = __TS__New(MyHomePage, &quot;Counter App Home Page&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        )</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    return ____exports</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The lowered and bundled Lua still somewhat resembles the input Typescript. Typescript ES6 modules are wrapped into Lua immediately invoked function expressions (IIFE), assigned string keys in the <code>package.preload</code> map and their <code>exports</code> made available by <code>require</code>ing them. This pattern should be familiar to anyone who&#x27;s hacked on Javascript bundlers/module resolvers like Browserify or Rollup.</p><p>Lua lacks builtin object-oriented programming (OOP) facilities (whether prototypal or otherwise). Typescript language features which don&#x27;t quite map one-to-one with Lua are shimmed using <code>__TS_*</code> functions made available through the <code>lualib_bundle</code> module (which <code>ts2hc</code> injects during bundling). Above, the <code>CounterApp</code> class is lowered into a series of calls to <code>__TS__Class</code> and <code>__TS__ClassExtends</code>, followed by placing its declared methods on its <code>prototype</code>.</p><p>The Lua bundle output by <code>ts2hc</code> will eventually be turned into bytecode by the PUC-RIO Lua 5.2 compiler, distributed under the name <code>luac52</code> by Hydro-SDK. The <code>build</code> method on the <code>CounterApp</code> class above would compile into something like the following:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">1   GETTABUP    1 0 -1  </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">2   GETUPVAL    2 1 </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">3   NEWTABLE    3 0 1   </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">4   GETTABUP    4 0 -1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">5   GETUPVAL    5 2 </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">6   CALL        4 2 2   </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">7   SETTABLE    3 -2 4</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">8   TAILCALL    1 3 0   </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">9   RETURN      1 0 </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">10  RETURN      0 1</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Lua bytecode is outside the scope of this article, though is mentioned here for completeness.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="mangling"></a>Mangling<a class="hash-link" href="#mangling" title="Direct link to heading">#</a></h3><p>In addition to lowering, <code>ts2hc</code> also undertakes an analysis pass of each output Lua module to discover its functions.</p><p>From the above example, <code>ts2hc</code> will record the following functions:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">CounterApp.prototype.____constructor</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">CounterApp.prototype.build</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>corresponding to the constructor and <code>build</code> method declarations of the original <code>CounterApp</code> class. These names are obviously captured from the original declaration names. For cases like our example (where clear function names where given), this works well enough.</p><p><code>ts2hc</code> cannot rely on the programmer giving it clear and comprehensible function names however. <code>ts2hc</code> takes the original symbol names from the output Lua module and performs <a href="https://en.wikipedia.org/wiki/Name_mangling#Name_mangling_in_C.2B.2B" target="_blank" rel="noopener noreferrer">name mangling</a>. The intent of name mangling is to uniquely identify a given function, no matter where or how it was declared. <code>ts2hc</code>&#x27;s name mangling approach is heavily inspired by the IA-64 Itanium C++ ABI as well as Rust&#x27;s name mangling approach. Whereas those two approaches rely heavily on type-information to produce their mangled names, Lua is a dynamic and un-typed language and offers no such convenience. <code>ts2hc</code> first considers the names and declaration order of function arguments resulting in the following:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">CounterApp.prototype.____constructor::self</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">CounterApp.prototype.build::self</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>That is not quite enough information to uniquely identify a function however. <code>ts2hc</code> further considers the hash of the Typescript filename, and a disambiguation index suffix to resolve mangled name conflicts by declaration order resulting in the following: </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">_Lae3eafcf842016833530caebe7755167b0866b5ac96416b45848c6fc6d65c58f::CounterApp.prototype.____constructor::self::0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">_Lae3eafcf842016833530caebe7755167b0866b5ac96416b45848c6fc6d65c58f::CounterApp.prototype.build::self::0    </span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>This form works perfectly for functions that are named by the programmer like class methods or free functions. Consider however if the <code>build</code> method on the <code>CounterApp</code> class were written to have an anonymous closure:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly typescript"><div tabindex="0" class="prism-code language-typescript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">build</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token maybe-class-name">Widget</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name maybe-class-name" style="color:rgb(255, 203, 107)">MaterialApp</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            title</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Counter App&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            initialRoute</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;/&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            home</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name maybe-class-name" style="color:rgb(255, 203, 107)">MyHomePage</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Counter App Home Page&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>For anonymous closures, <code>ts2hc</code> simply names them &quot;anonymous<em>closure&quot;. In order to uniquely identify anonymous closures (or any nested function declarations), a [dominator analysis](<a href="https://en.wikipedia.org/wiki/Dominator" target="_blank" rel="noopener noreferrer">https://en.wikipedia.org/wiki/Dominator</a></em>(graph_theory)) with respect to the declaration order of every function is performed. The mangled name of the immediate dominator as well as the mangled names of every member of the dominance frontier of each function are prefixed to its mangled name. For the anonymous closure in the example above, it results in the following mangled name:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">_Lae3eafcf842016833530caebe7755167b0866b5ac96416b45848c6fc6d65c58f::CounterApp.prototype.build::self::0::anonymous_closure::0</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>This form encodes enough information to uniquely identify a function. <code>ts2hc</code> will join each functions mangled name with information like the line/column numbers in the original Typescript file, the line/column numbers in the Lua module the original Typescript file was lowered into, the line/column numbers the function ended up in in the final Lua bundle and other information into a single debug symbol. These debug symbols are what power function maps, provide readable stack traces as well as hot-reload. </p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="runtime"></a>Runtime<a class="hash-link" href="#runtime" title="Direct link to heading">#</a></h2><p>Common Flutter Runtime (CFR) is a blanket term given to the Lua 5.2 virtual machine, binding system and other libraries at the core of Hydro-SDK&#x27;s runtime environment. Users generally don&#x27;t interact with the CFR directly, but rather through widgets like <code>RunComponent</code> and <code>RunComponentFromFile</code>.</p><p><code>ts2hc</code> and CFR are at the very core of the developer experience and runtime system of Hydro-SDK. They work together to support goal 2 above by providing an analog to Flutter&#x27;s killer development-time feature; hot-reload.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="pillars-of-hot-reload"></a>Pillars of Hot-Reload<a class="hash-link" href="#pillars-of-hot-reload" title="Direct link to heading">#</a></h3><p>In Flutter, hot-reload is provided by Dart VM. Dart VM&#x27;s hot-reload is based on a few <a href="https://github.com/dart-lang/sdk/wiki/Hot-reload#immutable-methods" target="_blank" rel="noopener noreferrer">pillars</a>:</p><p>Pervasive Late-Binding</p><ul><li>The program behaves as if method lookup happens at every call</li></ul><p>Immutable Methods</p><ul><li>The &quot;atoms&quot; of reload are methods. Methods are never mutated. Changes to a method declaration create a new method, mutating the class or library&#x27;s method dictionary. The old method may still exist if it has been captured by a closure or stack frame.</li><li>Closures capture their function when they are created. A closure always has the same function before and after a change, and all invocations of a given closure run the same function.</li></ul><p>State is Retained</p><ul><li>Hot reload does not reset fields, neither the fields of instances nor those of classes or libraries</li></ul><p>CFR&#x27;s hot-reload is inspired by (and largely abides by) the same pillars. CFR diverges from Dart VM however on the &quot;Immutable Methods&quot; pillar. In CFR, closures (and their scopes) are refreshed prior to every invocation. This means that old functions can never be invoked after a hot-reload no matter if they were captured by a closure. The only exception to this is if an old function is a stack frame. CFR uses the mangled name of debug symbols provided to it by <code>ts2hc</code> to uniquely address functions, allowing it to perform just-in-time method lookups and late-binding in a manner similar to Dart VM.</p><p>Consider the <code>build</code> method of the <code>MyHomePageState</code> class from the <a href="https://github.com/hydro-sdk/counter-app" target="_blank" rel="noopener noreferrer">Counter-App showcase</a>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly typescript"><div tabindex="0" class="prism-code language-typescript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token imports"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token imports">    </span><span class="token imports maybe-class-name">Text</span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token imports"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token imports">    </span><span class="token imports maybe-class-name">Center</span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token imports"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token imports">    </span><span class="token imports maybe-class-name">StatefulWidget</span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token imports"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token imports">    </span><span class="token imports maybe-class-name">State</span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token imports"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token imports">    </span><span class="token imports maybe-class-name">Column</span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token imports"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token imports">    </span><span class="token imports maybe-class-name">MainAxisAlignment</span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token imports"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token imports">    </span><span class="token imports maybe-class-name">Icon</span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token imports"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token imports"></span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;@hydro-sdk/hydro-sdk/runtime/flutter/widgets/index&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">AppBar</span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token imports"> </span><span class="token imports maybe-class-name">FloatingActionButton</span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token imports"> </span><span class="token imports maybe-class-name">Icons</span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token imports"> </span><span class="token imports maybe-class-name">Scaffold</span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token imports"> </span><span class="token imports maybe-class-name">Theme</span><span class="token imports"> </span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;@hydro-sdk/hydro-sdk/runtime/flutter/material/index&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">Widget</span><span class="token imports"> </span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;@hydro-sdk/hydro-sdk/runtime/flutter/widget&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">BuildContext</span><span class="token imports"> </span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;@hydro-sdk/hydro-sdk/runtime/flutter/buildContext&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">Key</span><span class="token imports"> </span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;@hydro-sdk/hydro-sdk/runtime/flutter/foundation/key&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//...</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">build</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">context</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token maybe-class-name">BuildContext</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token maybe-class-name">Widget</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name maybe-class-name" style="color:rgb(255, 203, 107)">Scaffold</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            appBar</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name maybe-class-name" style="color:rgb(255, 203, 107)">AppBar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                title</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name maybe-class-name" style="color:rgb(255, 203, 107)">Text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">title</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            body</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name maybe-class-name" style="color:rgb(255, 203, 107)">Center</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                child</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name maybe-class-name" style="color:rgb(255, 203, 107)">Column</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    mainAxisAlignment</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token maybe-class-name">MainAxisAlignment</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">center</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    children</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name maybe-class-name" style="color:rgb(255, 203, 107)">Text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;You have pushed the button this many times&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name maybe-class-name" style="color:rgb(255, 203, 107)">Text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">counter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">toString</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            key</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name maybe-class-name" style="color:rgb(255, 203, 107)">Key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;counter&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            style</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token maybe-class-name">Theme</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">of</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">context</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">textTheme</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">display1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            floatingActionButton</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name maybe-class-name" style="color:rgb(255, 203, 107)">FloatingActionButton</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                key</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name maybe-class-name" style="color:rgb(255, 203, 107)">Key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;increment&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                child</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name maybe-class-name" style="color:rgb(255, 203, 107)">Icon</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token maybe-class-name">Icons</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">add</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                onPressed</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">incrementCounter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Making simple additions or deletions like changing the string &quot;You have pushed the button this many times&quot; to something else or adding more <code>Text</code> widgets results in successful hot-reloads and no change in app state.</p><p>Consider a change to the original <code>build</code> method to the following:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly typescript"><div tabindex="0" class="prism-code language-typescript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token imports"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token imports">    </span><span class="token imports maybe-class-name">Text</span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token imports"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token imports">    </span><span class="token imports maybe-class-name">Center</span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token imports"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token imports">    </span><span class="token imports maybe-class-name">StatefulWidget</span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token imports"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token imports">    </span><span class="token imports maybe-class-name">State</span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token imports"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token imports">    </span><span class="token imports maybe-class-name">Column</span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token imports"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token imports">    </span><span class="token imports maybe-class-name">MainAxisAlignment</span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token imports"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token imports">    </span><span class="token imports maybe-class-name">Icon</span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token imports"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token imports">    </span><span class="token imports maybe-class-name">Container</span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token imports"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token imports">    </span><span class="token imports maybe-class-name">MediaQuery</span><span class="token imports"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token imports"></span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;@hydro-sdk/hydro-sdk/runtime/flutter/widgets/index&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">Colors</span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token imports"> </span><span class="token imports maybe-class-name">FloatingActionButton</span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token imports"> </span><span class="token imports maybe-class-name">Icons</span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token imports"> </span><span class="token imports maybe-class-name">MaterialApp</span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token imports"> </span><span class="token imports maybe-class-name">Scaffold</span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token imports"> </span><span class="token imports maybe-class-name">Theme</span><span class="token imports"> </span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;@hydro-sdk/hydro-sdk/runtime/flutter/material/index&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">Widget</span><span class="token imports"> </span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;@hydro-sdk/hydro-sdk/runtime/flutter/widget&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">BuildContext</span><span class="token imports"> </span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;@hydro-sdk/hydro-sdk/runtime/flutter/buildContext&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">Key</span><span class="token imports"> </span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;@hydro-sdk/hydro-sdk/runtime/flutter/foundation/key&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//...</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">build</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">context</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token maybe-class-name">BuildContext</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token maybe-class-name">Widget</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name maybe-class-name" style="color:rgb(255, 203, 107)">Scaffold</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            appBar</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name maybe-class-name" style="color:rgb(255, 203, 107)">AppBar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                title</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name maybe-class-name" style="color:rgb(255, 203, 107)">Text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">title</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            body</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name maybe-class-name" style="color:rgb(255, 203, 107)">Center</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                child</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name maybe-class-name" style="color:rgb(255, 203, 107)">Column</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    mainAxisAlignment</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token maybe-class-name">MainAxisAlignment</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">center</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    children</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//Add a thin blue box on top of the counter text</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name maybe-class-name" style="color:rgb(255, 203, 107)">Container</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            color</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token maybe-class-name">Colors</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">blue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">swatch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">100</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            height</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">25</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            width</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token maybe-class-name">MediaQuery</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">of</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">context</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">size</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">getWidth</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name maybe-class-name" style="color:rgb(255, 203, 107)">Text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;You have pushed the button this many times&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name maybe-class-name" style="color:rgb(255, 203, 107)">Text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">counter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">toString</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            key</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name maybe-class-name" style="color:rgb(255, 203, 107)">Key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;counter&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            style</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token maybe-class-name">Theme</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">of</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">context</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">textTheme</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">display1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            floatingActionButton</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name maybe-class-name" style="color:rgb(255, 203, 107)">FloatingActionButton</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                key</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name maybe-class-name" style="color:rgb(255, 203, 107)">Key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;increment&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                child</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name maybe-class-name" style="color:rgb(255, 203, 107)">Icon</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token maybe-class-name">Icons</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">add</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                onPressed</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">incrementCounter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The above change will result in an error like the following:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">attempt to index a nil value null swatch</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Error raised in: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  MyHomePageState.prototype.build</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     defined in counter-app/ota/lib/counterApp.ts:63</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">VM stacktrace follows:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">@.hydroc/0.0.1-nightly.231/ts2hc/40bd309e7516dae86ac3d02346f6d3a9b20fa010a9da4e6e3a65a33420bb9d32/index.ts:11563</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (_Lae3eafcf842016833530caebe7755167b0866b5ac96416b45848c6fc6d65c58f::MyHomePageState.prototype.build::self_context::0)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Dart stacktrace follows:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#0      Context.tableIndex package:hydro_sdk/â€¦/vm/context.dart:135</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#1      gettable           package:hydro_sdk/â€¦/instructions/gettable.dart:12</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#2      Frame.cont         package:hydro_sdk/â€¦/vm/frame.dart:228</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#3      Closure._dispatch  package:hydro_sdk/â€¦/vm/closure.dart:96</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#4      Closure.dispatch   package:hydro_sdk/â€¦/vm/closure.dart:69</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>This error is the result of <code>Colors.blue.swatch</code> being uninitialized. Recall the example Lua module output above. Imported symbols are assigned to the value of calls to <code>require</code>. The <code>build</code> method now closes over symbols that are uninitialized (the newly imported symbols). This is unfortunately an artifact of how Typescript modules are represented when lowered. The result is that referencing newly imported symbols in a hot-reloaded function will usually trigger an exception.</p><p>Hot-reload in Hydro-SDK is implemented purely in terms of Lua. Support for hot-reloading other programming languages (like Haxe and C#) in Hydro-SDK should not suffer from this same limitation (though will probably come with their own challenges and limitations).</p></div></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_GeHD"><a href="/blog/expressing-inexpressible-constant-values">Expressing Inexpressible Constant Values</a></h2><div class="margin-vert--md"><time datetime="2021-04-03T00:00:00.000Z" class="blogPostDate_fNvV">April 3, 2021 Â· 5 min read</time></div><div class="avatar margin-vert--md"><a href="https://github.com/chgibb" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/u/18079458?s=400&amp;v=4" alt="Chris Gibb"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/chgibb" target="_blank" rel="noopener noreferrer">Chris Gibb</a></h4><small class="avatar__subtitle">Recovering Structural Typing Enthusiast</small></div></div></header><div class="markdown"><p>Adventures in automatically binding Dart to Typescript.</p></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/flutter">flutter</a><a class="margin-horiz--sm" href="/blog/tags/typescript">typescript</a><a class="margin-horiz--sm" href="/blog/tags/react-native">react-native</a></div><div class="col text--right"><a aria-label="Read more about Expressing Inexpressible Constant Values" href="/blog/expressing-inexpressible-constant-values"><strong>Read More</strong></a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_GeHD"><a href="/blog/closing-over-type-formals-satisying-type-parameters">Closing Over Type Formals, Satisfying Type Parameters</a></h2><div class="margin-vert--md"><time datetime="2021-02-07T00:00:00.000Z" class="blogPostDate_fNvV">February 7, 2021 Â· 5 min read</time></div><div class="avatar margin-vert--md"><a href="https://github.com/chgibb" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/u/18079458?s=400&amp;v=4" alt="Chris Gibb"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/chgibb" target="_blank" rel="noopener noreferrer">Chris Gibb</a></h4><small class="avatar__subtitle">Recovering Structural Typing Enthusiast</small></div></div></header><div class="markdown"><p>Adventures in automatically binding Dart to Typescript.</p></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/flutter">flutter</a><a class="margin-horiz--sm" href="/blog/tags/typescript">typescript</a><a class="margin-horiz--sm" href="/blog/tags/react-native">react-native</a></div><div class="col text--right"><a aria-label="Read more about Closing Over Type Formals, Satisfying Type Parameters" href="/blog/closing-over-type-formals-satisying-type-parameters"><strong>Read More</strong></a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_GeHD"><a href="/blog/one-year-of-hydro-sdk">One Year of Hydro-SDK</a></h2><div class="margin-vert--md"><time datetime="2021-01-17T00:00:00.000Z" class="blogPostDate_fNvV">January 17, 2021 Â· 7 min read</time></div><div class="avatar margin-vert--md"><a href="https://github.com/chgibb" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/u/18079458?s=400&amp;v=4" alt="Chris Gibb"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/chgibb" target="_blank" rel="noopener noreferrer">Chris Gibb</a></h4><small class="avatar__subtitle">Recovering Structural Typing Enthusiast</small></div></div></header><div class="markdown"><p><a href="https://github.com/hydro-sdk/hydro-sdk" target="_blank" rel="noopener noreferrer">Hydro-SDK</a> has been my passion project for the last (roughly) year. While still very pre-alpha, I thought it was about time to collect my thoughts on its past and future in one place and reflect on the journey.</p></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/flutter">flutter</a><a class="margin-horiz--sm" href="/blog/tags/typescript">typescript</a><a class="margin-horiz--sm" href="/blog/tags/react-native">react-native</a></div><div class="col text--right"><a aria-label="Read more about One Year of Hydro-SDK" href="/blog/one-year-of-hydro-sdk"><strong>Read More</strong></a></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></main></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/hydro-sdk/hydro-sdk/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discussions</a></li><li class="footer__item"><a href="https://discord.gg/Au9GDXqp" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/hydro-sdk" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Hydro-SDK. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/styles.104c0177.js"></script>
<script src="/assets/js/runtime~main.6b4b8414.js"></script>
<script src="/assets/js/main.718a4841.js"></script>
<script src="/assets/js/common.f0b432a2.js"></script>
<script src="/assets/js/2.1e35f16c.js"></script>
<script src="/assets/js/3.4175dbb4.js"></script>
<script src="/assets/js/01a85c17.d0889b35.js"></script>
<script src="/assets/js/1be78505.76a4fcce.js"></script>
<script src="/assets/js/6875c492.96f4990e.js"></script>
<script src="/assets/js/a6aa9e1f.ae99bb64.js"></script>
<script src="/assets/js/c4f5d8e4.946bc6c1.js"></script>
<script src="/assets/js/ccc49370.833ec531.js"></script>
<script src="/assets/js/38.dfe7fe76.js"></script>
<script src="/assets/js/4ad842c4.0cfa62c8.js"></script>
<script src="/assets/js/13244c14.6386d569.js"></script>
<script src="/assets/js/42028e53.a87b0199.js"></script>
<script src="/assets/js/738a2c95.517a8b94.js"></script>
<script src="/assets/js/2f94a271.6284b725.js"></script>
<script src="/assets/js/b2b675dd.e30f7b16.js"></script>
</body>
</html>