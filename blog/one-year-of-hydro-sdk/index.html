<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.73">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Hydro-SDK Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Hydro-SDK Blog Atom Feed"><title data-react-helmet="true">Hydro-SDK</title><meta data-react-helmet="true" name="description" content="Hydro-SDK has been my passion project for the last (roughly) year. While still very pre-alpha, I thought it was about time to collect my thoughts on its past and future in one place and reflect on the journey."><meta data-react-helmet="true" property="og:description" content="Hydro-SDK has been my passion project for the last (roughly) year. While still very pre-alpha, I thought it was about time to collect my thoughts on its past and future in one place and reflect on the journey."><meta data-react-helmet="true" property="og:url" content="https://hydro-sdk.github.io/blog/one-year-of-hydro-sdk"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><meta data-react-helmet="true" property="og:title" content="Hydro-SDK"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://hydro-sdk.github.io/blog/one-year-of-hydro-sdk"><link data-react-helmet="true" rel="alternate" href="https://hydro-sdk.github.io/blog/one-year-of-hydro-sdk" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://hydro-sdk.github.io/blog/one-year-of-hydro-sdk" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.2445322a.css">
<link rel="preload" href="/assets/js/styles.c189e06e.js" as="script">
<link rel="preload" href="/assets/js/runtime~main.85b967c8.js" as="script">
<link rel="preload" href="/assets/js/main.df260ec4.js" as="script">
<link rel="preload" href="/assets/js/1.cb5c4bc0.js" as="script">
<link rel="preload" href="/assets/js/2.19ead029.js" as="script">
<link rel="preload" href="/assets/js/3.8541e6a7.js" as="script">
<link rel="preload" href="/assets/js/ccc49370.e4ce62d1.js" as="script">
<link rel="preload" href="/assets/js/4ad842c4.5e4623f9.js" as="script">
<link rel="preload" href="/assets/js/d2d046fa.1fd3342c.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="Hydro-SDK Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.png" alt="Hydro-SDK Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Hydro-SDK</strong></a><a class="navbar__item navbar__link" docid="intro" href="/docs/intro">Getting Started</a><a class="navbar__item navbar__link" docid="codepush" href="/docs/codepush">Codepush</a><a href="https://registry.hydro-sdk.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Registry</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/hydro-sdk" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="Hydro-SDK Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.png" alt="Hydro-SDK Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Hydro-SDK</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" docid="intro" href="/docs/intro">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" docid="codepush" href="/docs/codepush">Codepush</a></li><li class="menu__list-item"><a href="https://registry.hydro-sdk.io" target="_blank" rel="noopener noreferrer" class="menu__link">Registry</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/hydro-sdk" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><div class="col col--3"><div class="sidebar_2ahu thin-scrollbar"><h3 class="sidebarItemTitle_2hhb">Recent posts</h3><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/mangling-dynamic-language-symbols">Mangling Dynamic Language Symbols, Uniquely Addressing the Atoms of Hot-Reload</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/expressing-inexpressible-constant-values">Expressing Inexpressible Constant Values</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/closing-over-type-formals-satisying-type-parameters">Closing Over Type Formals, Satisfying Type Parameters</a></li><li class="sidebarItem_2UVv"><a aria-current="page" class="sidebarItemLink_1RT6 sidebarItemLinkActive_12pM" href="/blog/one-year-of-hydro-sdk">One Year of Hydro-SDK</a></li></ul></div></div><main class="col col--7"><article><header><h1 class="margin-bottom--sm blogPostTitle_GeHD">One Year of Hydro-SDK</h1><div class="margin-vert--md"><time datetime="2021-01-17T00:00:00.000Z" class="blogPostDate_fNvV">January 17, 2021 · 7 min read</time></div><div class="avatar margin-vert--md"><a href="https://github.com/chgibb" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/u/18079458?s=400&amp;v=4" alt="Chris Gibb"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/chgibb" target="_blank" rel="noopener noreferrer">Chris Gibb</a></h4><small class="avatar__subtitle">Recovering Structural Typing Enthusiast</small></div></div></header><div class="markdown"><p><a href="https://github.com/hydro-sdk/hydro-sdk" target="_blank" rel="noopener noreferrer">Hydro-SDK</a> has been my passion project for the last (roughly) year. While still very pre-alpha, I thought it was about time to collect my thoughts on its past and future in one place and reflect on the journey.</p><p>This was originally posted here: <a href="https://chgibb.github.io/one-year-of-hydro-sdk/" target="_blank" rel="noopener noreferrer">https://chgibb.github.io/one-year-of-hydro-sdk/</a></p><p><a href="https://github.com/hydro-sdk/hydro-sdk" target="_blank" rel="noopener noreferrer">Hydro-SDK</a> is a project with one large, ambitious goal. &quot;Become React Native for Flutter&quot;.<br>
It aims to do that by:</p><ol><li>Decoupling the API surface of Flutter from  the Dart programming language.</li><li>Decoupling the development time experience of Flutter from the Dart programming language.</li><li>Providing first-class support for over-the-air distribution of code.</li><li>Providing an ecosystem of packages from <code>pub.dev</code>, automatically projected to supported languages and published to other package systems.</li></ol><p>It&#x27;s composed of:</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="common-flutter-runtime-cfr"></a>Common Flutter Runtime (CFR)<a class="hash-link" href="#common-flutter-runtime-cfr" title="Direct link to heading">#</a></h3><ul><li>A Lua 5.2 interpreter with support for hot reload, clean Dart &lt;-&gt; Lua interop and compiling Lua bytecode into Dart source code.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="hydroc-compiler"></a>Hydroc Compiler<a class="hash-link" href="#hydroc-compiler" title="Direct link to heading">#</a></h3><ul><li>A toolchain based on <a href="https://github.com/TypeScriptToLua/TypeScriptToLua" target="_blank" rel="noopener noreferrer">Typescript to Lua</a>, providing incremental compilation of Typescript source code into Lua bytecode, source mappings, file watching and serving.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="structured-wrapper-and-interface-generator-for-dart-swid"></a>Structured Wrapper and Interface generator for Dart (SWID)<a class="hash-link" href="#structured-wrapper-and-interface-generator-for-dart-swid" title="Direct link to heading">#</a></h3><ul><li>A system for automatically producing Hydroc and CFR compatible projections from a Dart package.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="waveform"></a>Waveform<a class="hash-link" href="#waveform" title="Direct link to heading">#</a></h3><ul><li>An umbrella project of tooling and Github bots providing automatic upgrade infrastructure for the Hydro-SDK Github organization; automated update PRs, wrangling of dependencies between <code>package.json</code> and <code>pubspec.yaml</code>, merge conflict resolution and topic branch updating.</li></ul><p>Hydro-SDK was born out of my experiences as a brand new Flutter developer in mid-2019. A Flutter developer who had never even heard of Flutter (or Dart for that matter) before being hired for a Flutter role.</p><p>I&#x27;m not a very old developer. At the time of writing, I&#x27;m only 1.71 JQuerys old. After spending my formative years hacking on C++98, followed by a few years of JQuery and JQuery UI before finally discovering ReactJS and falling deeply and maddly in love with Typescript, Flutter was a revelation. No more changing one line in one function in one header and having to go take a walk as three quarters of the project recompiles. No more burning my fingers on my Macbook keyboard hoping I can find the bug in my React frontend before my fingerprints are gone for good. Stateful hot reload was the new normal.</p><p>In addition to the positive revelations I felt for Flutter&#x27;s hot reload workflow and the simplicity and power of it&#x27;s API compared to traditional HTML+CSS, my reactions to Dart were roughly as follows:  </p><ol><li>Whiplash having to get used to nominal typing again</li><li>Horror at the depth of reification</li><li>Frustration at (relatively) in-expressive generics and poor inference</li><li>Wonder and bewilderment at null related errors</li><li>Acceptance. An understanding of Dart&#x27;s history, it&#x27;s many customers (in addition to Flutter) its flaws and its successes</li></ol><p>In August of 2019 I began experimenting trying to build a general system to allow Flutter web content to exist nicely within a larger Flutter mobile shell. I thought if I couldn&#x27;t quite get around Dart&#x27;s shortcomings, I could at least build something to paper over the shortcomings in mobile deployment. This work ultimately didn&#x27;t lead very far.</p><p>My feelings about the developer experience of Dart never quite went away. I became fixated on the idea of bringing the tooling, workflow and APIs of Flutter into other languages. Late 2019 saw experimentation with exposing Flutter APIs into Javascript via a C++ bridge with DuktapeJS. When I realised that every single <code>new</code> of a Dart object from Javascript was leaking memory and their didn&#x27;t seem to be a good path to get the Dart GC and Duktape&#x27;s GC to play nice together, I abandoned the initiative.</p><p>I abandoned the idea of embedding an interpreter and looked to building one with Dart. This led to my discovery of <a href="https://github.com/cowboyd/flutterscript/commits/master" target="_blank" rel="noopener noreferrer">Flutterscript</a>, a project aimed at providing a scripting environment through a Lisp interpreter. I spent far more late nights than I should have trying to bring the Flutterscript interpreter to the point where it could run <a href="https://github.com/akapav/js" target="_blank" rel="noopener noreferrer">a JS to Lisp transpiler</a>. This included porting pieces of the <a href="http://www.sbcl.org/" target="_blank" rel="noopener noreferrer">Steel Bank Common Lisp</a> runtime to Flutterscript. I also spent some time trying to get <a href="https://github.com/cowboyd/flutterscript/commits/master" target="_blank" rel="noopener noreferrer">Flutterscript</a> to run code output by <a href="https://github.com/froggey/Iota" target="_blank" rel="noopener noreferrer">Iota</a>. I eventually realized that even if I could cobble such a monster together, it would be impossible to debug and even harder to attempt to tune for performance.</p><p>In early 2020, I stumbled on <a href="https://github.com/TypeScriptToLua/TypeScriptToLua" target="_blank" rel="noopener noreferrer">Typescript to Lua (TSTL)</a>. A transpiler offering transpilation from Typescript to Lua sourcecode. This seemed like the beacon in the storm. I immediately set out to start writing a Lua interpreter in Dart. After some progress on my own hand-rolled interpreter, I discovered <a href="https://github.com/PixelToast/dartlua" target="_blank" rel="noopener noreferrer">DartLua</a> which had me beat both in terms of developer-hours and feature set. A (heavily modified) DartLua has sat at the center of Hydro-SDK every since.</p><p>The first &quot;Hello World From Typescript!&quot; Flutter app hit the screen of an iOS simulator in February 2020. I spent the next 6 months or so building a marshalling system to allow clean Dart and Lua interop as well as hot reloading of running Lua bytecode. In response to some early feedback about performance concerns, a CLI was built to allow compiling Lua bytecode into Dart source code.</p><p>Eventually I got greedy with these successes and looked to expand the repertoire of the runtime system I was now calling the Common Flutter Runtime (CFR) by building support into Hydro&#x27;s toolchain for <a href="https://haxe.org/" target="_blank" rel="noopener noreferrer">the Haxe programming language</a> in addition to the already existing Typescript support. Shortly after the first &quot;Hello World from Haxe&quot;! Flutter app, I overwhelmed myself trying to expand and maintain Flutter and Dart APIs across both Typescript and Haxe and so dropped support for Haxe.</p><p>In mid 2020 I looked to double down on support for Typescript by building out the at the time badly neglected cupertino Flutter APIs.</p><p>By late September, I came to the realisation that the manual process of writing Typescript and Dart glue to project APIs into Typescript could probably be automated. I put down work on manually writing cupertino projections and looked to start automating the process.</p><p>The project of the day ever since has been on what has come to be named Structured Wrapper and Interface Generator for Dart (SWID). The name being a nod to the <a href="http://www.swig.org/exec.html" target="_blank" rel="noopener noreferrer">SWIG  Project</a>. In just three months time, SWID has come very far. Being able to produce projections for large swaths of Flutter Foundation as well as Dart UI and Dart Core. The focus at the time of writing has been to make sure the code produced by SWID is natural for a Typescript programmer and is correct. This is being done by porting pieces of Dart-SDK&#x27;s <a href="https://github.com/dart-lang/co19" target="_blank" rel="noopener noreferrer">CO19 specification test suite</a> into Typescript to test SWID produced projections for a select few Dart Core classes.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="future-work"></a>Future Work<a class="hash-link" href="#future-work" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="ambient-computing-ambient-packages"></a>Ambient Computing, Ambient Packages<a class="hash-link" href="#ambient-computing-ambient-packages" title="Direct link to heading">#</a></h3><p>Looking to the future, SWID will be the cornerstone in bridging the gap between <code>pub.dev</code>, Hydro-SDK and <code>npm</code>. Hopefully bringing the power of each together into one repository of packages. <code>pub.dev</code> package authors will get an automated Typescript mirror of their work, app developers will get to pick and choose from the best of <code>pub.dev</code>, and <code>npm</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="ambient-computing-ambient-languages"></a>Ambient Computing, Ambient Languages<a class="hash-link" href="#ambient-computing-ambient-languages" title="Direct link to heading">#</a></h3><p>In addition to enabling a wider package ecosystem, SWID will provide the foundation for wider language support. SWID is structured in a classic frontend-backend compiler design. Typescript and Dart both just happen to be backends. Adding support for additional languages, like <a href="https://haxe.org/" target="_blank" rel="noopener noreferrer">the Haxe programming language</a>, C# via <a href="https://github.com/yanghuan/CSharp.lua" target="_blank" rel="noopener noreferrer">CSharp.lua</a> or Java or Kotlin via <a href="https://github.com/jtransc/jtransc" target="_blank" rel="noopener noreferrer">JTransc</a> will be as easy as adding a new backend to SWID.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="in-band-out-of-band"></a>In Band, Out of Band<a class="hash-link" href="#in-band-out-of-band" title="Direct link to heading">#</a></h3><p>At the time of writing, the developer experience for deploying an app making use of Hydro-SDK&#x27;s over the air code loading is shakey at best. Planning is beginning on what a first-class hosting, deployment, flagging and analytics service might look like and how to best integrate it with Hydro-SDK.</p><p>My hope is that other developers will find Hydro-SDK to be an incredible value add to their workflows and development processes. At worst, Hydro-SDK presents an incredible, beautiful fractal of all the problem spaces of compiler design, optimization, virtual machines and programming language design that I find endlessly fascinating and fulfilling.</p></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/flutter">flutter</a><a class="margin-horiz--sm" href="/blog/tags/typescript">typescript</a><a class="margin-horiz--sm" href="/blog/tags/react-native">react-native</a></div></footer></article><div><a href="https://github.com/hydro-sdk/hydro-sdk.io/edit/main/blog/2021-01-17-one-year-of-hydro-sdk.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="margin-vert--xl"><nav class="pagination-nav" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/closing-over-type-formals-satisying-type-parameters"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">« Closing Over Type Formals, Satisfying Type Parameters</div></a></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></main><div class="col col--2"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#common-flutter-runtime-cfr" class="table-of-contents__link">Common Flutter Runtime (CFR)</a></li><li><a href="#hydroc-compiler" class="table-of-contents__link">Hydroc Compiler</a></li><li><a href="#structured-wrapper-and-interface-generator-for-dart-swid" class="table-of-contents__link">Structured Wrapper and Interface generator for Dart (SWID)</a></li><li><a href="#waveform" class="table-of-contents__link">Waveform</a></li><li><a href="#future-work" class="table-of-contents__link">Future Work</a><ul><li><a href="#ambient-computing-ambient-packages" class="table-of-contents__link">Ambient Computing, Ambient Packages</a></li><li><a href="#ambient-computing-ambient-languages" class="table-of-contents__link">Ambient Computing, Ambient Languages</a></li><li><a href="#in-band-out-of-band" class="table-of-contents__link">In Band, Out of Band</a></li></ul></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/codepush">Codepush</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/hydro-sdk/hydro-sdk/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discussions</a></li><li class="footer__item"><a href="https://discord.gg/DuM2vkUSNr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/hydro-sdk" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021 Hydro-SDK. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/styles.c189e06e.js"></script>
<script src="/assets/js/runtime~main.85b967c8.js"></script>
<script src="/assets/js/main.df260ec4.js"></script>
<script src="/assets/js/1.cb5c4bc0.js"></script>
<script src="/assets/js/2.19ead029.js"></script>
<script src="/assets/js/3.8541e6a7.js"></script>
<script src="/assets/js/ccc49370.e4ce62d1.js"></script>
<script src="/assets/js/4ad842c4.5e4623f9.js"></script>
<script src="/assets/js/d2d046fa.1fd3342c.js"></script>
</body>
</html>