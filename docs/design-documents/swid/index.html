<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.73">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Hydro-SDK Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Hydro-SDK Blog Atom Feed"><title data-react-helmet="true">Structured Wrapper and Interface Generator for Dart (SWID) | Hydro-SDK</title><meta data-react-helmet="true" property="og:url" content="https://hydro-sdk.github.io/docs/design-documents/swid"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Structured Wrapper and Interface Generator for Dart (SWID) | Hydro-SDK"><meta data-react-helmet="true" name="description" content="https://github.com/hydro-sdk/hydro-sdk/tree/master/lib/swid"><meta data-react-helmet="true" property="og:description" content="https://github.com/hydro-sdk/hydro-sdk/tree/master/lib/swid"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://hydro-sdk.github.io/docs/design-documents/swid"><link data-react-helmet="true" rel="alternate" href="https://hydro-sdk.github.io/docs/design-documents/swid" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://hydro-sdk.github.io/docs/design-documents/swid" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.2445322a.css">
<link rel="preload" href="/assets/js/styles.5ab1bbc7.js" as="script">
<link rel="preload" href="/assets/js/runtime~main.e7c67a23.js" as="script">
<link rel="preload" href="/assets/js/main.278c1167.js" as="script">
<link rel="preload" href="/assets/js/1.7c4f4ce8.js" as="script">
<link rel="preload" href="/assets/js/2.fe7d2ea3.js" as="script">
<link rel="preload" href="/assets/js/3.f81e6f45.js" as="script">
<link rel="preload" href="/assets/js/1be78505.ded007cf.js" as="script">
<link rel="preload" href="/assets/js/48.25d56849.js" as="script">
<link rel="preload" href="/assets/js/935f2afb.04a32f8e.js" as="script">
<link rel="preload" href="/assets/js/17896441.c2bd4fbb.js" as="script">
<link rel="preload" href="/assets/js/9a63d7ae.98f7b42d.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="Hydro-SDK Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.png" alt="Hydro-SDK Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Hydro-SDK</strong></a><a class="navbar__item navbar__link" docid="intro" href="/docs/intro">Getting Started</a><a class="navbar__item navbar__link" docid="codepush" href="/docs/codepush">Codepush</a><a href="https://registry.hydro-sdk.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Registry</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/hydro-sdk" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="Hydro-SDK Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.png" alt="Hydro-SDK Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Hydro-SDK</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" docid="intro" href="/docs/intro">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" docid="codepush" href="/docs/codepush">Codepush</a></li><li class="menu__list-item"><a href="https://registry.hydro-sdk.io" target="_blank" rel="noopener noreferrer" class="menu__link">Registry</a></li><li class="menu__list-item"><a class="menu__link" href="/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/hydro-sdk" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/intro">Tutorial - Adding to a Flutter App</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/codepush">Tutorial - Codepush and the Hydro-SDK Registry</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Design Documents</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/design-documents/swid">Structured Wrapper and Interface Generator for Dart (SWID)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design-documents/cfr">Common Flutter Runtime (CFR)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design-documents/ota">Over the Air (OTA) Package Files</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design-documents/registry">Registry</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design-documents/architecture">Hydro-SDK Design</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/docs/edge-cases-and-errors">Edge Cases and Errors</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/limitations">Limitations</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/sdk-tools">SDK-Tools</a></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">Structured Wrapper and Interface Generator for Dart (SWID)</h1></header><div class="markdown"><p><a href="https://github.com/hydro-sdk/hydro-sdk/tree/master/lib/swid" target="_blank" rel="noopener noreferrer">https://github.com/hydro-sdk/hydro-sdk/tree/master/lib/swid</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="objective"></a>Objective<a class="hash-link" href="#objective" title="Direct link to heading">#</a></h2><p>Provide a tool to automatically produce code to bind a given Dart package to CFR and provide an interface that can be consumed from supported programming languages.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="background"></a>Background<a class="hash-link" href="#background" title="Direct link to heading">#</a></h2><p>In the past, bindings for classes in <code>package:flutter</code> and <code>dart:*</code> have been written by hand. These hand written bindings usually expose the smallest surface area possible to satisfy the intended use case. i.e. being able to call <code>new AppBar</code> from TypeScript rather than being able to also extend and override <code>AppBar</code>, or to access properties and methods on a given <code>AppBar</code>. Changes in the bound API need to be hand updated as the original package changes.</p><p>Taking a given piece of code in a given source language, binding it to (making it callable from) and projecting it (making APIs that capture the intent of the original language in the target language) to one or more target languages is a well explored space. SWID takes great inspiration from projects like the <a href="http://www.swig.org/" target="_blank" rel="noopener noreferrer">Simplified Wrapper and Interface Generator (SWIG) project</a> and <a href="https://github.com/microsoft/xlang" target="_blank" rel="noopener noreferrer">Microsoft&#x27;s Xlang</a>,</p><p>SWIG relies heavily on &quot;SWIG interface files&quot; to drive code generation. Xlang similarly relies on &quot;Windows Metadata&quot; files. The intent in both cases is to describe the API that is to be bound and projected. SWID aims to remove this boilerplace as much as possible and drive its code generation from Dart source code.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="binding-system-overview"></a>Binding System Overview<a class="hash-link" href="#binding-system-overview" title="Direct link to heading">#</a></h2><p>In addition to providing far superior developer ergonomics over hand writing bindings for Dart packages, SWID also presents an opportunity to formalize and standardize binding schemes and uses cases.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="boxing"></a>Boxing<a class="hash-link" href="#boxing" title="Direct link to heading">#</a></h3><p>Instances of classes passing call boundaries from Dart code and into CFR code are said to be &quot;boxed&quot;. That is, they are wrapped in an instance of <a href="https://github.com/hydro-sdk/hydro-sdk/blob/master/lib/cfr/builtins/boxing/boxes.dart" target="_blank" rel="noopener noreferrer"><code>Box&lt;T&gt;</code></a>. <code>Box&lt;T&gt;</code> combines the original object with a Lua table. The CFR has special knowledge of <code>Box&lt;T&gt;</code>s. Table set and get operations are directed to the table field of the <code>Box&lt;T&gt;</code>.</p><p>Instances of classes passing call boundaries from CFR code and into Dart code are said to be &quot;unboxed&quot;. That is, the containing <code>Box&lt;T&gt;</code> is stripped away and the enclosed <code>T</code> is returned.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="virtual-machine-managed-class"></a>Virtual Machine Managed Class<a class="hash-link" href="#virtual-machine-managed-class" title="Direct link to heading">#</a></h3><p>A &quot;virtual machine managed class&quot; is a term used to describe an instance of a class that was allocated in Dart code, not in CFR. For each class in a Dart package being bound, SWID emits a &quot;virtual machine managed class declaration&quot;. That is, a class that extends <code>Box&lt;T&gt;</code> where <code>T</code> is the class being bound and that provides redirections and appropriate bindings from its Lua table to the class instance that it manages. Instances of this class will allow CFR code to access the underlying instance in terms of the associated Lua table.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="runtime-managed-class"></a>Runtime Managed Class<a class="hash-link" href="#runtime-managed-class" title="Direct link to heading">#</a></h3><p>A &quot;runtime managed class&quot; is a term used to describe an instance of a class that was allocated in CFR, not in Dart code. For each class that is being bound, SWID emits a &quot;runtime managed class declaration&quot;. That is, a class that extends <code>T</code> and implements <code>Box&lt;T&gt;</code> where <code>T</code> is the class being bound and that provides redirections and appropriate bindings from its Lua table to the class instance that it manages.</p><p>Each &quot;runtime managed class declaration&quot; provides overrides for every method, getter and setter of <code>T</code> that redirect to its Lua table. This allows Dart code to opaquely access methods of the &quot;runtime managed class&quot; which are actually implemented in CFR.</p><p>Unlike a &quot;virtual machine managed class&quot;, &quot;runtime managed classes&quot; Lua table redirections are given in terms <code>_dart_method</code> where <code>method</code> is the name of the method from <code>T</code> being bound. In order to make the given projection natural for consumers, language projections are expected to provide <code>method</code> declarations that redirect by default to <code>_dart_method</code>. This allows target language consumers to extend projected classes and provide method overrides implemented in terms of CFR.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="intermediate-representation-ir"></a>Intermediate Representation (IR)<a class="hash-link" href="#intermediate-representation-ir" title="Direct link to heading">#</a></h2><p>SWID maintains its own IR. <a href="https://github.com/hydro-sdk/hydro-sdk/tree/master/lib/swid/ir" target="_blank" rel="noopener noreferrer">SWID IR</a> closely mirrors a Dart abstract syntax tree (AST). The important caveat is that SWID IR does not fully represent the semantics of the Dart language. Getters, setters and operator overloads are not specially represented in SWID IR. SWID IR also does not explicitly represent Dart libraries or packages. </p><p>SWID IR is the primitive upon which all analyses, transformations and code generation are performed.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="frontends"></a>Frontends<a class="hash-link" href="#frontends" title="Direct link to heading">#</a></h2><p>SWID frontends are responsible for producing SWID IR. </p><p>SWID&#x27;s <a href="https://github.com/hydro-sdk/hydro-sdk/tree/master/lib/swid/frontend/dart" target="_blank" rel="noopener noreferrer">Dart frontend</a> takes a Dart package and produces SWID IR.</p><p>There is a second (though still experimental) frontend called <a href="https://github.com/hydro-sdk/hydro-sdk/tree/master/lib/swid/frontend/swidi" target="_blank" rel="noopener noreferrer">SWIDI</a> for producing SWID IR from SWID interface (or SWIDI) files.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="backends"></a>Backends<a class="hash-link" href="#backends" title="Direct link to heading">#</a></h2><p>SWID backends are responsible for producing translation units which will be written to disk as code files.</p><p>SWID&#x27;s <a href="https://github.com/hydro-sdk/hydro-sdk/tree/master/lib/swid/backend/dart" target="_blank" rel="noopener noreferrer">Dart backend</a> is responsible for producing Dart code that can be loaded into CFR to provide bindings for a given Dart package.</p><p>SWID&#x27;s <a href="https://github.com/hydro-sdk/hydro-sdk/tree/master/lib/swid/backend/ts" target="_blank" rel="noopener noreferrer">TypeScript backend</a> is responsible for producing TypeScript code that accurately projects the given Dart package and works with the associated Dart binding code to allow consumers to access, allocate and extend classes from the given Dart package.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/hydro-sdk/hydro-sdk.io/edit/main/docs/design-documents/swid.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/codepush"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Tutorial - Codepush and the Hydro-SDK Registry</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/design-documents/cfr"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Common Flutter Runtime (CFR) »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#objective" class="table-of-contents__link">Objective</a></li><li><a href="#background" class="table-of-contents__link">Background</a></li><li><a href="#binding-system-overview" class="table-of-contents__link">Binding System Overview</a><ul><li><a href="#boxing" class="table-of-contents__link">Boxing</a></li><li><a href="#virtual-machine-managed-class" class="table-of-contents__link">Virtual Machine Managed Class</a></li><li><a href="#runtime-managed-class" class="table-of-contents__link">Runtime Managed Class</a></li></ul></li><li><a href="#intermediate-representation-ir" class="table-of-contents__link">Intermediate Representation (IR)</a></li><li><a href="#frontends" class="table-of-contents__link">Frontends</a></li><li><a href="#backends" class="table-of-contents__link">Backends</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/codepush">Codepush</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/hydro-sdk/hydro-sdk/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discussions</a></li><li class="footer__item"><a href="https://discord.gg/DuM2vkUSNr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/hydro-sdk" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021 Hydro-SDK. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/styles.5ab1bbc7.js"></script>
<script src="/assets/js/runtime~main.e7c67a23.js"></script>
<script src="/assets/js/main.278c1167.js"></script>
<script src="/assets/js/1.7c4f4ce8.js"></script>
<script src="/assets/js/2.fe7d2ea3.js"></script>
<script src="/assets/js/3.f81e6f45.js"></script>
<script src="/assets/js/1be78505.ded007cf.js"></script>
<script src="/assets/js/48.25d56849.js"></script>
<script src="/assets/js/935f2afb.04a32f8e.js"></script>
<script src="/assets/js/17896441.c2bd4fbb.js"></script>
<script src="/assets/js/9a63d7ae.98f7b42d.js"></script>
</body>
</html>